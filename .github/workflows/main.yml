# Tên của workflow, sẽ hiển thị trong tab "Actions"
name: Node.js App Workflow

# Workflow này sẽ được kích hoạt khi có code được đẩy lên branch "main"
# Hoặc có thể được chạy thủ công từ tab "Actions"
on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  # Tên của job, bạn có thể đặt tùy ý
  build-and-run:
    # Chạy trên một máy ảo Ubuntu mới nhất do GitHub cung cấp
    runs-on: ubuntu-latest

    steps:
      # Bước 1: Checkout mã nguồn từ repository của bạn
      # Lệnh này sẽ tải code trong repo của bạn vào máy ảo
      - name: Checkout repository code
        uses: actions/checkout@v4

      # Bước 2: Thiết lập môi trường Node.js phiên bản 22
      # Tương đương với lệnh "FROM node:22" trong Dockerfile
      - name: Setup Node.js v22
        uses: actions/setup-node@v4
        with:
          node-version: '22'

      # Bước 3: Cập nhật và cài đặt các công cụ cần thiết
      - name: Install Git and SSHX
        run: |
          sudo apt-get update
          sudo apt-get install -y git
          # Cài đặt sshx (lưu ý: workflow không tương tác, nên sshx chỉ được cài chứ không chạy session)
          curl -sSf https://sshx.io/get | sh

      # Bước 4: Cấp quyền thực thi cho các file
      # Giả định các file cần thiết như app.js đã có trong repo của bạn
      - name: Make files executable
        run: chmod +x *

      # Bước 5: Chạy ứng dụng chính
      # Tương đương với lệnh "CMD" trong Dockerfile
      - name: Run the Node.js application
        run: node app.js
